<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Case Study: ER Injuries | Mastering Shiny Solutions</title>
  <meta name="description" content="A solutions manual to Hadley Wickham’s Mastering Shiny." />
  <meta name="generator" content="bookdown 0.32 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Case Study: ER Injuries | Mastering Shiny Solutions" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="A solutions manual to Hadley Wickham’s Mastering Shiny." />
  <meta name="github-repo" content="r4ds/mastering_shiny_book_solutions" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Case Study: ER Injuries | Mastering Shiny Solutions" />
  
  <meta name="twitter:description" content="A solutions manual to Hadley Wickham’s Mastering Shiny." />
  

<meta name="author" content="The R4DS Online Learning Community" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="basic-reactivity.html"/>
<link rel="next" href="workflow.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-102068953-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-102068953-3');
</script>



<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Mastering Shiny Solutions</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#note-boxes"><i class="fa fa-check"></i>Note Boxes</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i><b>1</b> Preface</a></li>
<li class="chapter" data-level="2" data-path="your-first-shiny-app.html"><a href="your-first-shiny-app.html"><i class="fa fa-check"></i><b>2</b> Your First Shiny App</a>
<ul>
<li class="chapter" data-level="" data-path="your-first-shiny-app.html"><a href="your-first-shiny-app.html#exercise-2.8.1"><i class="fa fa-check"></i>Exercise 2.8.1</a></li>
<li class="chapter" data-level="" data-path="your-first-shiny-app.html"><a href="your-first-shiny-app.html#exercise-2.8.2"><i class="fa fa-check"></i>Exercise 2.8.2</a></li>
<li class="chapter" data-level="" data-path="your-first-shiny-app.html"><a href="your-first-shiny-app.html#exercise-2.8.3"><i class="fa fa-check"></i>Exercise 2.8.3</a></li>
<li class="chapter" data-level="" data-path="your-first-shiny-app.html"><a href="your-first-shiny-app.html#exercise-2.8.4"><i class="fa fa-check"></i>Exercise 2.8.4</a></li>
<li class="chapter" data-level="" data-path="your-first-shiny-app.html"><a href="your-first-shiny-app.html#exercise-2.8.5"><i class="fa fa-check"></i>Exercise 2.8.5</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="basic-ui.html"><a href="basic-ui.html"><i class="fa fa-check"></i><b>3</b> Basic UI</a>
<ul>
<li class="chapter" data-level="" data-path="basic-ui.html"><a href="basic-ui.html#exercise-3.2.8.1"><i class="fa fa-check"></i>Exercise 3.2.8.1</a></li>
<li class="chapter" data-level="" data-path="basic-ui.html"><a href="basic-ui.html#exercise-3.2.8.2"><i class="fa fa-check"></i>Exercise 3.2.8.2</a></li>
<li class="chapter" data-level="" data-path="basic-ui.html"><a href="basic-ui.html#exercise-3.2.8.3"><i class="fa fa-check"></i>Exercise 3.2.8.3</a></li>
<li class="chapter" data-level="" data-path="basic-ui.html"><a href="basic-ui.html#exercise-3.2.8.4"><i class="fa fa-check"></i>Exercise 3.2.8.4</a></li>
<li class="chapter" data-level="" data-path="basic-ui.html"><a href="basic-ui.html#exercise-3.2.8.5"><i class="fa fa-check"></i>Exercise 3.2.8.5</a></li>
<li class="chapter" data-level="" data-path="basic-ui.html"><a href="basic-ui.html#exercise-3.3.5.1"><i class="fa fa-check"></i>Exercise 3.3.5.1</a></li>
<li class="chapter" data-level="" data-path="basic-ui.html"><a href="basic-ui.html#exercise-3.3.5.2"><i class="fa fa-check"></i>Exercise 3.3.5.2</a></li>
<li class="chapter" data-level="" data-path="basic-ui.html"><a href="basic-ui.html#exercise-3.4.6.1"><i class="fa fa-check"></i>Exercise 3.4.6.1</a></li>
<li class="chapter" data-level="" data-path="basic-ui.html"><a href="basic-ui.html#exercise-3.4.6.2"><i class="fa fa-check"></i>Exercise 3.4.6.2</a></li>
<li class="chapter" data-level="" data-path="basic-ui.html"><a href="basic-ui.html#exercise-3.4.6.3"><i class="fa fa-check"></i>Exercise 3.4.6.3</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="basic-reactivity.html"><a href="basic-reactivity.html"><i class="fa fa-check"></i><b>4</b> Basic Reactivity</a>
<ul>
<li class="chapter" data-level="" data-path="basic-reactivity.html"><a href="basic-reactivity.html#exercise-4.3.6.1"><i class="fa fa-check"></i>Exercise 4.3.6.1</a></li>
<li class="chapter" data-level="" data-path="basic-reactivity.html"><a href="basic-reactivity.html#exercise-4.3.6.2"><i class="fa fa-check"></i>Exercise 4.3.6.2</a></li>
<li class="chapter" data-level="" data-path="basic-reactivity.html"><a href="basic-reactivity.html#exercise-4.4.6.1"><i class="fa fa-check"></i>Exercise 4.4.6.1</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="case-study-er-injuries.html"><a href="case-study-er-injuries.html"><i class="fa fa-check"></i><b>5</b> Case Study: ER Injuries</a>
<ul>
<li class="chapter" data-level="" data-path="case-study-er-injuries.html"><a href="case-study-er-injuries.html#exercise-5.8.1"><i class="fa fa-check"></i>Exercise 5.8.1</a></li>
<li class="chapter" data-level="" data-path="case-study-er-injuries.html"><a href="case-study-er-injuries.html#exercise-5.8.2"><i class="fa fa-check"></i>Exercise 5.8.2</a></li>
<li class="chapter" data-level="" data-path="case-study-er-injuries.html"><a href="case-study-er-injuries.html#exercise-5.8.3"><i class="fa fa-check"></i>Exercise 5.8.3</a></li>
<li class="chapter" data-level="" data-path="case-study-er-injuries.html"><a href="case-study-er-injuries.html#exercise-5.8.4"><i class="fa fa-check"></i>Exercise 5.8.4</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="workflow.html"><a href="workflow.html"><i class="fa fa-check"></i><b>6</b> Workflow</a></li>
<li class="chapter" data-level="7" data-path="graphics.html"><a href="graphics.html"><i class="fa fa-check"></i><b>7</b> Graphics</a>
<ul>
<li class="chapter" data-level="" data-path="graphics.html"><a href="graphics.html#exercise-7.6.1"><i class="fa fa-check"></i>Exercise 7.6.1</a></li>
<li class="chapter" data-level="" data-path="graphics.html"><a href="graphics.html#exercise-7.6.2"><i class="fa fa-check"></i>Exercise 7.6.2</a></li>
<li class="chapter" data-level="" data-path="graphics.html"><a href="graphics.html#exercise-7.6.3"><i class="fa fa-check"></i>Exercise 7.6.3</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="user-feedback.html"><a href="user-feedback.html"><i class="fa fa-check"></i><b>8</b> User Feedback</a></li>
<li class="chapter" data-level="9" data-path="uploads-and-downloads.html"><a href="uploads-and-downloads.html"><i class="fa fa-check"></i><b>9</b> Uploads and Downloads</a>
<ul>
<li class="chapter" data-level="" data-path="uploads-and-downloads.html"><a href="uploads-and-downloads.html#exercise-9.4.1"><i class="fa fa-check"></i>Exercise 9.4.1</a></li>
<li class="chapter" data-level="" data-path="uploads-and-downloads.html"><a href="uploads-and-downloads.html#exercise-9.4.2"><i class="fa fa-check"></i>Exercise 9.4.2</a></li>
<li class="chapter" data-level="" data-path="uploads-and-downloads.html"><a href="uploads-and-downloads.html#exercise-9.4.3"><i class="fa fa-check"></i>Exercise 9.4.3</a></li>
<li class="chapter" data-level="" data-path="uploads-and-downloads.html"><a href="uploads-and-downloads.html#exercise-9.4.4"><i class="fa fa-check"></i>Exercise 9.4.4</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="dynamic-ui.html"><a href="dynamic-ui.html"><i class="fa fa-check"></i><b>10</b> Dynamic UI</a>
<ul>
<li class="chapter" data-level="" data-path="dynamic-ui.html"><a href="dynamic-ui.html#exercise-10.1.5.1"><i class="fa fa-check"></i>Exercise 10.1.5.1</a></li>
<li class="chapter" data-level="" data-path="dynamic-ui.html"><a href="dynamic-ui.html#exercise-10.1.5.2"><i class="fa fa-check"></i>Exercise 10.1.5.2</a></li>
<li class="chapter" data-level="" data-path="dynamic-ui.html"><a href="dynamic-ui.html#exercise-10.1.5.3"><i class="fa fa-check"></i>Exercise 10.1.5.3</a></li>
<li class="chapter" data-level="" data-path="dynamic-ui.html"><a href="dynamic-ui.html#exercise-10.1.5.4"><i class="fa fa-check"></i>Exercise 10.1.5.4</a></li>
<li class="chapter" data-level="" data-path="dynamic-ui.html"><a href="dynamic-ui.html#exercise-10.1.5.5"><i class="fa fa-check"></i>Exercise 10.1.5.5</a></li>
<li class="chapter" data-level="" data-path="dynamic-ui.html"><a href="dynamic-ui.html#exercise-10.2.3.1"><i class="fa fa-check"></i>Exercise 10.2.3.1</a></li>
<li class="chapter" data-level="" data-path="dynamic-ui.html"><a href="dynamic-ui.html#exercise-10.2.3.2"><i class="fa fa-check"></i>Exercise 10.2.3.2</a></li>
<li class="chapter" data-level="" data-path="dynamic-ui.html"><a href="dynamic-ui.html#exercise-10.2.3.3"><i class="fa fa-check"></i>Exercise 10.2.3.3</a></li>
<li class="chapter" data-level="" data-path="dynamic-ui.html"><a href="dynamic-ui.html#exercise-10.3.4.1"><i class="fa fa-check"></i>Exercise 10.3.4.1</a></li>
<li class="chapter" data-level="" data-path="dynamic-ui.html"><a href="dynamic-ui.html#exercise-10.3.4.2"><i class="fa fa-check"></i>Exercise 10.3.4.2</a></li>
<li class="chapter" data-level="" data-path="dynamic-ui.html"><a href="dynamic-ui.html#exercise-10.3.4.3"><i class="fa fa-check"></i>Exercise 10.3.4.3</a></li>
<li class="chapter" data-level="" data-path="dynamic-ui.html"><a href="dynamic-ui.html#exercise-10.3.4.4"><i class="fa fa-check"></i>Exercise 10.3.4.4</a></li>
<li class="chapter" data-level="" data-path="dynamic-ui.html"><a href="dynamic-ui.html#exercise-10.3.4.5"><i class="fa fa-check"></i>Exercise 10.3.4.5</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="bookmarking.html"><a href="bookmarking.html"><i class="fa fa-check"></i><b>11</b> Bookmarking</a>
<ul>
<li class="chapter" data-level="" data-path="bookmarking.html"><a href="bookmarking.html#exercise-11.3.1"><i class="fa fa-check"></i>Exercise 11.3.1</a></li>
<li class="chapter" data-level="" data-path="bookmarking.html"><a href="bookmarking.html#exercise-11.3.2"><i class="fa fa-check"></i>Exercise 11.3.2</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="tidy-evaluation.html"><a href="tidy-evaluation.html"><i class="fa fa-check"></i><b>12</b> Tidy Evaluation</a></li>
<li class="chapter" data-level="13" data-path="general-guidelines.html"><a href="general-guidelines.html"><i class="fa fa-check"></i><b>13</b> General Guidelines</a></li>
<li class="chapter" data-level="14" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>14</b> Functions</a>
<ul>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-14.4.1"><i class="fa fa-check"></i>Exercise 14.4.1</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-14.4.2"><i class="fa fa-check"></i>Exercise 14.4.2</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-14.4.3"><i class="fa fa-check"></i>Exercise 14.4.3</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="modules.html"><a href="modules.html"><i class="fa fa-check"></i><b>15</b> Modules</a>
<ul>
<li class="chapter" data-level="" data-path="modules.html"><a href="modules.html#exercise-15.6.1"><i class="fa fa-check"></i>Exercise 15.6.1</a></li>
<li class="chapter" data-level="" data-path="modules.html"><a href="modules.html#exercise-15.6.2"><i class="fa fa-check"></i>Exercise 15.6.2</a></li>
<li class="chapter" data-level="" data-path="modules.html"><a href="modules.html#exercise-15.6.3"><i class="fa fa-check"></i>Exercise 15.6.3</a></li>
<li class="chapter" data-level="" data-path="modules.html"><a href="modules.html#exercise-15.6.4"><i class="fa fa-check"></i>Exercise 15.6.4</a></li>
<li class="chapter" data-level="" data-path="modules.html"><a href="modules.html#exercise-15.6.5"><i class="fa fa-check"></i>Exercise 15.6.5</a></li>
<li class="chapter" data-level="" data-path="modules.html"><a href="modules.html#exercise-15.6.6"><i class="fa fa-check"></i>Exercise 15.6.6</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="packages.html"><a href="packages.html"><i class="fa fa-check"></i><b>16</b> Packages</a></li>
<li class="chapter" data-level="17" data-path="testing.html"><a href="testing.html"><i class="fa fa-check"></i><b>17</b> Testing</a></li>
<li class="chapter" data-level="18" data-path="safety.html"><a href="safety.html"><i class="fa fa-check"></i><b>18</b> Safety</a></li>
<li class="chapter" data-level="19" data-path="performance.html"><a href="performance.html"><i class="fa fa-check"></i><b>19</b> Performance</a></li>
<li class="chapter" data-level="20" data-path="why-reactivity.html"><a href="why-reactivity.html"><i class="fa fa-check"></i><b>20</b> Why reactivity?</a></li>
<li class="chapter" data-level="21" data-path="dependency-tracking.html"><a href="dependency-tracking.html"><i class="fa fa-check"></i><b>21</b> Dependency Tracking</a></li>
<li class="chapter" data-level="22" data-path="scoping.html"><a href="scoping.html"><i class="fa fa-check"></i><b>22</b> Scoping</a></li>
<li class="chapter" data-level="23" data-path="reactive-components.html"><a href="reactive-components.html"><i class="fa fa-check"></i><b>23</b> Reactive Components</a></li>
<li class="chapter" data-level="24" data-path="advanced-ui.html"><a href="advanced-ui.html"><i class="fa fa-check"></i><b>24</b> Advanced UI</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Mastering Shiny Solutions</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="case-study-er-injuries" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">Chapter 5</span> Case Study: ER Injuries<a href="case-study-er-injuries.html#case-study-er-injuries" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="exercise-5.8.1" class="section level3 unnumbered hasAnchor">
<h3>Exercise 5.8.1<a href="case-study-er-injuries.html#exercise-5.8.1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Draw the reactive graph for each app.</p>
<div class="solution">
<p><span id="unlabeled-div-19" class="solution"><em>Solution</em>. </span></p>
<div id="solution-18" class="section level4 unnumbered hasAnchor">
<h4>Solution<a href="case-study-er-injuries.html#solution-18" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div id="prototype" class="section level5 unnumbered hasAnchor">
<h5>Prototype<a href="case-study-er-injuries.html#prototype" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>The prototype application has a single input, <code>input$code</code>, which is used to
generate the <code>selected()</code> reactive. This reactive is used directly in 3
outputs, <code>output$diag</code>, <code>output$body_part</code>, and <code>output$location</code>, and it is
also used indirectly in the <code>output$age_sex</code> plot via the <code>summary()</code> reactive.</p>
<center>
<div class="figure">
<img src="images/5.8.1-prototype.png" width="500" alt="" />
<p class="caption">reactive graph - prototype app</p>
</div>
</center>
<p><br></p>
</div>
<div id="rate-vs.-count" class="section level5 unnumbered hasAnchor">
<h5>Rate vs. Count<a href="case-study-er-injuries.html#rate-vs.-count" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Building on the prototype, we create a second input <code>input$y</code> which is used
along with the <code>summary()</code> reactive to create the <code>output$age_sex</code> plot.</p>
<center>
<div class="figure">
<img src="images/5.8.1-ratecount.png" width="500" alt="" />
<p class="caption">reactive graph - rate vs. count app</p>
</div>
</center>
<p><br></p>
</div>
<div id="narrative" class="section level5 unnumbered hasAnchor">
<h5>Narrative<a href="case-study-er-injuries.html#narrative" class="anchor-section" aria-label="Anchor link to header"></a></h5>
<p>Building on the application once more, we create an <code>output$narrative</code> that
depends on the <code>selected()</code> reactive and a new input, <code>input$story</code>.</p>
<center>
<div class="figure">
<img src="images/5.8.1-narrative.png" width="500" alt="" />
<p class="caption">reactive graph - narrative app</p>
</div>
</center>
</div>
</div>
</div>
<!---------------------------------------------------------------------------->
<!---------------------------------------------------------------------------->
<!---------------------------------------------------------------------------->
</div>
<div id="exercise-5.8.2" class="section level3 unnumbered hasAnchor">
<h3>Exercise 5.8.2<a href="case-study-er-injuries.html#exercise-5.8.2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>What happens if you flip <code>fct_infreq()</code> and <code>fct_lump()</code> in the code that
reduces the summary tables?</p>
<div class="solution">
<p><span id="unlabeled-div-20" class="solution"><em>Solution</em>. </span></p>
<div id="solution-19" class="section level4 unnumbered hasAnchor">
<h4>Solution<a href="case-study-er-injuries.html#solution-19" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>As in the book, we will use the datasets <code>injuries</code>, <code>products</code>, and
<code>population</code> appearing here:
<a href="https://github.com/hadley/mastering-shiny/blob/main/neiss/data.R" class="uri">https://github.com/hadley/mastering-shiny/blob/main/neiss/data.R</a>.</p>
<p>Flipping the order of <code>fct_infreq()</code> and <code>fct_lump()</code> will only change the
factor levels order. In particular, the function <code>fct_infreq()</code> orders the
factor levels by frequency, and the function <code>fct_lump()</code> also orders the
factor levels by frequency but it will only keep the top <code>n</code> factors and label
the rest as <code>Other</code>.</p>
<p>Let us look at the top five levels in terms of count within the <code>diag</code> column
in the <code>injuries</code> dataset:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="case-study-er-injuries.html#cb24-1" aria-hidden="true" tabindex="-1"></a>injuries <span class="sc">%&gt;%</span></span>
<span id="cb24-2"><a href="case-study-er-injuries.html#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(diag) <span class="sc">%&gt;%</span></span>
<span id="cb24-3"><a href="case-study-er-injuries.html#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span></span>
<span id="cb24-4"><a href="case-study-er-injuries.html#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>n) <span class="sc">%&gt;%</span></span>
<span id="cb24-5"><a href="case-study-er-injuries.html#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">5</span>)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 2
## # Groups:   diag [5]
##   diag                      n
##   &lt;chr&gt;                 &lt;int&gt;
## 1 Other Or Not Stated   44937
## 2 Fracture              43093
## 3 Laceration            39230
## 4 Strain, Sprain        37002
## 5 Contusion Or Abrasion 35259</code></pre>
<p>If we apply <code>fct_infreq()</code> first, then it will reorder the factor levels in
descending order as seen in the previous output. If afterwards we apply
<code>fct_lump()</code>, then it will lump together everything after the nth most commonly
seen level.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="case-study-er-injuries.html#cb26-1" aria-hidden="true" tabindex="-1"></a>diag <span class="ot">&lt;-</span> injuries <span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="case-study-er-injuries.html#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diag =</span> <span class="fu">fct_lump</span>(<span class="fu">fct_infreq</span>(diag), <span class="at">n =</span> <span class="dv">5</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb26-3"><a href="case-study-er-injuries.html#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(diag)</span>
<span id="cb26-4"><a href="case-study-er-injuries.html#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="case-study-er-injuries.html#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(diag)</span></code></pre></div>
<pre><code>## [1] &quot;Other Or Not Stated&quot;   &quot;Fracture&quot;              &quot;Laceration&quot;           
## [4] &quot;Strain, Sprain&quot;        &quot;Contusion Or Abrasion&quot; &quot;Other&quot;</code></pre>
<p>Conversely, if we apply <code>fct_lump()</code> first, then it will label the most
frequently seen factor level as “Other”. If afterwards we apply <code>fct_infreq()</code>,
then it will label the first level as “Other” and not as “Other Or Not Stated”,
which was the case for the previous code.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="case-study-er-injuries.html#cb28-1" aria-hidden="true" tabindex="-1"></a>diag <span class="ot">&lt;-</span> injuries <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="case-study-er-injuries.html#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diag =</span> <span class="fu">fct_infreq</span>(<span class="fu">fct_lump</span>(diag, <span class="at">n =</span> <span class="dv">5</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="case-study-er-injuries.html#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(diag)</span>
<span id="cb28-4"><a href="case-study-er-injuries.html#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="case-study-er-injuries.html#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(diag)</span></code></pre></div>
<pre><code>## [1] &quot;Other&quot;                 &quot;Other Or Not Stated&quot;   &quot;Fracture&quot;             
## [4] &quot;Laceration&quot;            &quot;Strain, Sprain&quot;        &quot;Contusion Or Abrasion&quot;</code></pre>
</div>
</div>
<!---------------------------------------------------------------------------->
<!---------------------------------------------------------------------------->
<!---------------------------------------------------------------------------->
</div>
<div id="exercise-5.8.3" class="section level3 unnumbered hasAnchor">
<h3>Exercise 5.8.3<a href="case-study-er-injuries.html#exercise-5.8.3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Add an input control that lets the user decide how many rows to show in the
summary tables.</p>
<div class="solution">
<p><span id="unlabeled-div-21" class="solution"><em>Solution</em>. </span></p>
<div id="solution-20" class="section level4 unnumbered hasAnchor">
<h4>Solution<a href="case-study-er-injuries.html#solution-20" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Our function <code>count_top</code> is responsible for grouping our variables into a set
number of factors, lumping the rest of the values into “Other”. The function
has an argument <code>n</code> which is set to <code>5</code>. By creating a <code>numericInput</code> called
<code>rows</code> we can let the user set the number of <code>fct_infreq</code> dynamically. However,
because <code>fct_infreq</code> is the number of factors + <code>Other</code>, we need to subtract 1
from what the user selects in order to display the number of rows they input.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="case-study-er-injuries.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb30-2"><a href="case-study-er-injuries.html#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats)</span>
<span id="cb30-3"><a href="case-study-er-injuries.html#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb30-4"><a href="case-study-er-injuries.html#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb30-5"><a href="case-study-er-injuries.html#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="case-study-er-injuries.html#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: these exercises use the datasets `injuries`, `products`, and</span></span>
<span id="cb30-7"><a href="case-study-er-injuries.html#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co"># `population` as created here:</span></span>
<span id="cb30-8"><a href="case-study-er-injuries.html#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="co"># https://github.com/hadley/mastering-shiny/blob/main/neiss/data.R</span></span>
<span id="cb30-9"><a href="case-study-er-injuries.html#cb30-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-10"><a href="case-study-er-injuries.html#cb30-10" aria-hidden="true" tabindex="-1"></a>count_top <span class="ot">&lt;-</span> <span class="cf">function</span>(df, var, <span class="at">n =</span> <span class="dv">5</span>) {</span>
<span id="cb30-11"><a href="case-study-er-injuries.html#cb30-11" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb30-12"><a href="case-study-er-injuries.html#cb30-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>({{ var }} <span class="sc">:</span><span class="er">=</span> <span class="fu">fct_lump</span>(<span class="fu">fct_infreq</span>({{ var }}), <span class="at">n =</span> n)) <span class="sc">%&gt;%</span></span>
<span id="cb30-13"><a href="case-study-er-injuries.html#cb30-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>({{ var }}) <span class="sc">%&gt;%</span></span>
<span id="cb30-14"><a href="case-study-er-injuries.html#cb30-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">as.integer</span>(<span class="fu">sum</span>(weight)))</span>
<span id="cb30-15"><a href="case-study-er-injuries.html#cb30-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-16"><a href="case-study-er-injuries.html#cb30-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-17"><a href="case-study-er-injuries.html#cb30-17" aria-hidden="true" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb30-18"><a href="case-study-er-injuries.html#cb30-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fluidRow</span>(</span>
<span id="cb30-19"><a href="case-study-er-injuries.html#cb30-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column</span>(<span class="dv">8</span>, <span class="fu">selectInput</span>(<span class="st">&quot;code&quot;</span>, <span class="st">&quot;Product&quot;</span>,</span>
<span id="cb30-20"><a href="case-study-er-injuries.html#cb30-20" aria-hidden="true" tabindex="-1"></a>                          <span class="at">choices =</span> <span class="fu">setNames</span>(products<span class="sc">$</span>prod_code, products<span class="sc">$</span>title),</span>
<span id="cb30-21"><a href="case-study-er-injuries.html#cb30-21" aria-hidden="true" tabindex="-1"></a>                          <span class="at">width =</span> <span class="st">&quot;100%&quot;</span>)</span>
<span id="cb30-22"><a href="case-study-er-injuries.html#cb30-22" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb30-23"><a href="case-study-er-injuries.html#cb30-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column</span>(<span class="dv">2</span>, <span class="fu">numericInput</span>(<span class="st">&quot;rows&quot;</span>, <span class="st">&quot;Number of Rows&quot;</span>,</span>
<span id="cb30-24"><a href="case-study-er-injuries.html#cb30-24" aria-hidden="true" tabindex="-1"></a>                           <span class="at">min =</span> <span class="dv">1</span>, <span class="at">max =</span> <span class="dv">10</span>, <span class="at">value =</span> <span class="dv">5</span>)),</span>
<span id="cb30-25"><a href="case-study-er-injuries.html#cb30-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column</span>(<span class="dv">2</span>, <span class="fu">selectInput</span>(<span class="st">&quot;y&quot;</span>, <span class="st">&quot;Y Axis&quot;</span>, <span class="fu">c</span>(<span class="st">&quot;rate&quot;</span>, <span class="st">&quot;count&quot;</span>)))</span>
<span id="cb30-26"><a href="case-study-er-injuries.html#cb30-26" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb30-27"><a href="case-study-er-injuries.html#cb30-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fluidRow</span>(</span>
<span id="cb30-28"><a href="case-study-er-injuries.html#cb30-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column</span>(<span class="dv">4</span>, <span class="fu">tableOutput</span>(<span class="st">&quot;diag&quot;</span>)),</span>
<span id="cb30-29"><a href="case-study-er-injuries.html#cb30-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column</span>(<span class="dv">4</span>, <span class="fu">tableOutput</span>(<span class="st">&quot;body_part&quot;</span>)),</span>
<span id="cb30-30"><a href="case-study-er-injuries.html#cb30-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column</span>(<span class="dv">4</span>, <span class="fu">tableOutput</span>(<span class="st">&quot;location&quot;</span>))</span>
<span id="cb30-31"><a href="case-study-er-injuries.html#cb30-31" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb30-32"><a href="case-study-er-injuries.html#cb30-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fluidRow</span>(</span>
<span id="cb30-33"><a href="case-study-er-injuries.html#cb30-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column</span>(<span class="dv">12</span>, <span class="fu">plotOutput</span>(<span class="st">&quot;age_sex&quot;</span>))</span>
<span id="cb30-34"><a href="case-study-er-injuries.html#cb30-34" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb30-35"><a href="case-study-er-injuries.html#cb30-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fluidRow</span>(</span>
<span id="cb30-36"><a href="case-study-er-injuries.html#cb30-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column</span>(<span class="dv">2</span>, <span class="fu">actionButton</span>(<span class="st">&quot;story&quot;</span>, <span class="st">&quot;Tell me a story&quot;</span>)),</span>
<span id="cb30-37"><a href="case-study-er-injuries.html#cb30-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column</span>(<span class="dv">10</span>, <span class="fu">textOutput</span>(<span class="st">&quot;narrative&quot;</span>))</span>
<span id="cb30-38"><a href="case-study-er-injuries.html#cb30-38" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-39"><a href="case-study-er-injuries.html#cb30-39" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-40"><a href="case-study-er-injuries.html#cb30-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-41"><a href="case-study-er-injuries.html#cb30-41" aria-hidden="true" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb30-42"><a href="case-study-er-injuries.html#cb30-42" aria-hidden="true" tabindex="-1"></a>  selected <span class="ot">&lt;-</span> <span class="fu">reactive</span>(injuries <span class="sc">%&gt;%</span> <span class="fu">filter</span>(prod_code <span class="sc">==</span> input<span class="sc">$</span>code))</span>
<span id="cb30-43"><a href="case-study-er-injuries.html#cb30-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-44"><a href="case-study-er-injuries.html#cb30-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Find the maximum possible of rows.</span></span>
<span id="cb30-45"><a href="case-study-er-injuries.html#cb30-45" aria-hidden="true" tabindex="-1"></a>  max_no_rows <span class="ot">&lt;-</span> <span class="fu">reactive</span>(</span>
<span id="cb30-46"><a href="case-study-er-injuries.html#cb30-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">max</span>(<span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">selected</span>()<span class="sc">$</span>diag)),</span>
<span id="cb30-47"><a href="case-study-er-injuries.html#cb30-47" aria-hidden="true" tabindex="-1"></a>        <span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">selected</span>()<span class="sc">$</span>body_part)),</span>
<span id="cb30-48"><a href="case-study-er-injuries.html#cb30-48" aria-hidden="true" tabindex="-1"></a>        <span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">selected</span>()<span class="sc">$</span>location)))</span>
<span id="cb30-49"><a href="case-study-er-injuries.html#cb30-49" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-50"><a href="case-study-er-injuries.html#cb30-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-51"><a href="case-study-er-injuries.html#cb30-51" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Update the maximum value for the numericInput based on max_no_rows().</span></span>
<span id="cb30-52"><a href="case-study-er-injuries.html#cb30-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">observeEvent</span>(input<span class="sc">$</span>code, {</span>
<span id="cb30-53"><a href="case-study-er-injuries.html#cb30-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateNumericInput</span>(session, <span class="st">&quot;rows&quot;</span>, <span class="at">max =</span> <span class="fu">max_no_rows</span>())</span>
<span id="cb30-54"><a href="case-study-er-injuries.html#cb30-54" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb30-55"><a href="case-study-er-injuries.html#cb30-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-56"><a href="case-study-er-injuries.html#cb30-56" aria-hidden="true" tabindex="-1"></a>  table_rows <span class="ot">&lt;-</span> <span class="fu">reactive</span>(input<span class="sc">$</span>rows <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb30-57"><a href="case-study-er-injuries.html#cb30-57" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-58"><a href="case-study-er-injuries.html#cb30-58" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>diag <span class="ot">&lt;-</span> <span class="fu">renderTable</span>(</span>
<span id="cb30-59"><a href="case-study-er-injuries.html#cb30-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count_top</span>(<span class="fu">selected</span>(), diag, <span class="at">n =</span> <span class="fu">table_rows</span>()), <span class="at">width =</span> <span class="st">&quot;100%&quot;</span>)</span>
<span id="cb30-60"><a href="case-study-er-injuries.html#cb30-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-61"><a href="case-study-er-injuries.html#cb30-61" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>body_part <span class="ot">&lt;-</span> <span class="fu">renderTable</span>(</span>
<span id="cb30-62"><a href="case-study-er-injuries.html#cb30-62" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count_top</span>(<span class="fu">selected</span>(), body_part, <span class="at">n =</span> <span class="fu">table_rows</span>()), <span class="at">width =</span> <span class="st">&quot;100%&quot;</span>)</span>
<span id="cb30-63"><a href="case-study-er-injuries.html#cb30-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-64"><a href="case-study-er-injuries.html#cb30-64" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>location <span class="ot">&lt;-</span> <span class="fu">renderTable</span>(</span>
<span id="cb30-65"><a href="case-study-er-injuries.html#cb30-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count_top</span>(<span class="fu">selected</span>(), location, <span class="at">n =</span> <span class="fu">table_rows</span>()), <span class="at">width =</span> <span class="st">&quot;100%&quot;</span>)</span>
<span id="cb30-66"><a href="case-study-er-injuries.html#cb30-66" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-67"><a href="case-study-er-injuries.html#cb30-67" aria-hidden="true" tabindex="-1"></a>  summary <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb30-68"><a href="case-study-er-injuries.html#cb30-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">selected</span>() <span class="sc">%&gt;%</span></span>
<span id="cb30-69"><a href="case-study-er-injuries.html#cb30-69" aria-hidden="true" tabindex="-1"></a>      <span class="fu">count</span>(age, sex, <span class="at">wt =</span> weight) <span class="sc">%&gt;%</span></span>
<span id="cb30-70"><a href="case-study-er-injuries.html#cb30-70" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(population, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;sex&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb30-71"><a href="case-study-er-injuries.html#cb30-71" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">rate =</span> n <span class="sc">/</span> population <span class="sc">*</span> <span class="fl">1e4</span>)</span>
<span id="cb30-72"><a href="case-study-er-injuries.html#cb30-72" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb30-73"><a href="case-study-er-injuries.html#cb30-73" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-74"><a href="case-study-er-injuries.html#cb30-74" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>age_sex <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb30-75"><a href="case-study-er-injuries.html#cb30-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="sc">$</span>y <span class="sc">==</span> <span class="st">&quot;count&quot;</span>) {</span>
<span id="cb30-76"><a href="case-study-er-injuries.html#cb30-76" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summary</span>() <span class="sc">%&gt;%</span></span>
<span id="cb30-77"><a href="case-study-er-injuries.html#cb30-77" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ggplot</span>(<span class="fu">aes</span>(age, n, <span class="at">colour =</span> sex)) <span class="sc">+</span></span>
<span id="cb30-78"><a href="case-study-er-injuries.html#cb30-78" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb30-79"><a href="case-study-er-injuries.html#cb30-79" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Estimated number of injuries&quot;</span>) <span class="sc">+</span></span>
<span id="cb30-80"><a href="case-study-er-injuries.html#cb30-80" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme_grey</span>(<span class="dv">15</span>)</span>
<span id="cb30-81"><a href="case-study-er-injuries.html#cb30-81" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb30-82"><a href="case-study-er-injuries.html#cb30-82" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summary</span>() <span class="sc">%&gt;%</span></span>
<span id="cb30-83"><a href="case-study-er-injuries.html#cb30-83" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ggplot</span>(<span class="fu">aes</span>(age, rate, <span class="at">colour =</span> sex)) <span class="sc">+</span></span>
<span id="cb30-84"><a href="case-study-er-injuries.html#cb30-84" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_line</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb30-85"><a href="case-study-er-injuries.html#cb30-85" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Injuries per 10,000 people&quot;</span>) <span class="sc">+</span></span>
<span id="cb30-86"><a href="case-study-er-injuries.html#cb30-86" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme_grey</span>(<span class="dv">15</span>)</span>
<span id="cb30-87"><a href="case-study-er-injuries.html#cb30-87" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb30-88"><a href="case-study-er-injuries.html#cb30-88" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb30-89"><a href="case-study-er-injuries.html#cb30-89" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-90"><a href="case-study-er-injuries.html#cb30-90" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>narrative <span class="ot">&lt;-</span> <span class="fu">renderText</span>({</span>
<span id="cb30-91"><a href="case-study-er-injuries.html#cb30-91" aria-hidden="true" tabindex="-1"></a>    input<span class="sc">$</span>story</span>
<span id="cb30-92"><a href="case-study-er-injuries.html#cb30-92" aria-hidden="true" tabindex="-1"></a>    <span class="fu">selected</span>() <span class="sc">%&gt;%</span> <span class="fu">pull</span>(narrative) <span class="sc">%&gt;%</span> <span class="fu">sample</span>(<span class="dv">1</span>)</span>
<span id="cb30-93"><a href="case-study-er-injuries.html#cb30-93" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb30-94"><a href="case-study-er-injuries.html#cb30-94" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-95"><a href="case-study-er-injuries.html#cb30-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-96"><a href="case-study-er-injuries.html#cb30-96" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(ui, server)</span></code></pre></div>
</div>
</div>
<!---------------------------------------------------------------------------->
<!---------------------------------------------------------------------------->
<!---------------------------------------------------------------------------->
</div>
<div id="exercise-5.8.4" class="section level3 unnumbered hasAnchor">
<h3>Exercise 5.8.4<a href="case-study-er-injuries.html#exercise-5.8.4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Provide a way to step through every narrative systematically with forward and
backward buttons.</p>
<p>Advanced: Make the list of narratives “circular” so that advancing forward from
the last narrative takes you to the first.</p>
<div class="solution">
<p><span id="unlabeled-div-22" class="solution"><em>Solution</em>. </span></p>
<div id="solution-21" class="section level4 unnumbered hasAnchor">
<h4>Solution<a href="case-study-er-injuries.html#solution-21" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We can add two action buttons <code>prev_story</code> and <code>next_story</code> to iterate through the
narrative. We can leverage the fact that whenever you click an action button in Shiny, the button stores how many times that button has been clicked. To caculate the index of the current story, we can subtract the stored count of the <code>next_story</code> button from the <code>previous_story</code> button. Then, by using the modulus operator, we can increase the current position in the narrative while never go beyond the interval [1, length of the narrative].</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="case-study-er-injuries.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb31-2"><a href="case-study-er-injuries.html#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats)</span>
<span id="cb31-3"><a href="case-study-er-injuries.html#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb31-4"><a href="case-study-er-injuries.html#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb31-5"><a href="case-study-er-injuries.html#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="case-study-er-injuries.html#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: these exercises use the datasets `injuries`, `products`, and</span></span>
<span id="cb31-7"><a href="case-study-er-injuries.html#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co"># `population` as created here:</span></span>
<span id="cb31-8"><a href="case-study-er-injuries.html#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="co"># https://github.com/hadley/mastering-shiny/blob/main/neiss/data.R</span></span>
<span id="cb31-9"><a href="case-study-er-injuries.html#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="case-study-er-injuries.html#cb31-10" aria-hidden="true" tabindex="-1"></a>count_top <span class="ot">&lt;-</span> <span class="cf">function</span>(df, var, <span class="at">n =</span> <span class="dv">5</span>) {</span>
<span id="cb31-11"><a href="case-study-er-injuries.html#cb31-11" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb31-12"><a href="case-study-er-injuries.html#cb31-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>({{ var }} <span class="sc">:</span><span class="er">=</span> <span class="fu">fct_lump</span>(<span class="fu">fct_infreq</span>({{ var }}), <span class="at">n =</span> n)) <span class="sc">%&gt;%</span></span>
<span id="cb31-13"><a href="case-study-er-injuries.html#cb31-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>({{ var }}) <span class="sc">%&gt;%</span></span>
<span id="cb31-14"><a href="case-study-er-injuries.html#cb31-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">as.integer</span>(<span class="fu">sum</span>(weight)))</span>
<span id="cb31-15"><a href="case-study-er-injuries.html#cb31-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-16"><a href="case-study-er-injuries.html#cb31-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-17"><a href="case-study-er-injuries.html#cb31-17" aria-hidden="true" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb31-18"><a href="case-study-er-injuries.html#cb31-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fluidRow</span>(</span>
<span id="cb31-19"><a href="case-study-er-injuries.html#cb31-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column</span>(<span class="dv">8</span>, <span class="fu">selectInput</span>(<span class="st">&quot;code&quot;</span>, <span class="st">&quot;Product&quot;</span>,</span>
<span id="cb31-20"><a href="case-study-er-injuries.html#cb31-20" aria-hidden="true" tabindex="-1"></a>                          <span class="at">choices =</span> <span class="fu">setNames</span>(products<span class="sc">$</span>prod_code, products<span class="sc">$</span>title),</span>
<span id="cb31-21"><a href="case-study-er-injuries.html#cb31-21" aria-hidden="true" tabindex="-1"></a>                          <span class="at">width =</span> <span class="st">&quot;100%&quot;</span>)</span>
<span id="cb31-22"><a href="case-study-er-injuries.html#cb31-22" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb31-23"><a href="case-study-er-injuries.html#cb31-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column</span>(<span class="dv">2</span>, <span class="fu">numericInput</span>(<span class="st">&quot;rows&quot;</span>, <span class="st">&quot;Number of Rows&quot;</span>,</span>
<span id="cb31-24"><a href="case-study-er-injuries.html#cb31-24" aria-hidden="true" tabindex="-1"></a>                           <span class="at">min =</span> <span class="dv">1</span>, <span class="at">max =</span> <span class="dv">10</span>, <span class="at">value =</span> <span class="dv">5</span>)),</span>
<span id="cb31-25"><a href="case-study-er-injuries.html#cb31-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column</span>(<span class="dv">2</span>, <span class="fu">selectInput</span>(<span class="st">&quot;y&quot;</span>, <span class="st">&quot;Y Axis&quot;</span>, <span class="fu">c</span>(<span class="st">&quot;rate&quot;</span>, <span class="st">&quot;count&quot;</span>)))</span>
<span id="cb31-26"><a href="case-study-er-injuries.html#cb31-26" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb31-27"><a href="case-study-er-injuries.html#cb31-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fluidRow</span>(</span>
<span id="cb31-28"><a href="case-study-er-injuries.html#cb31-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column</span>(<span class="dv">4</span>, <span class="fu">tableOutput</span>(<span class="st">&quot;diag&quot;</span>)),</span>
<span id="cb31-29"><a href="case-study-er-injuries.html#cb31-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column</span>(<span class="dv">4</span>, <span class="fu">tableOutput</span>(<span class="st">&quot;body_part&quot;</span>)),</span>
<span id="cb31-30"><a href="case-study-er-injuries.html#cb31-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column</span>(<span class="dv">4</span>, <span class="fu">tableOutput</span>(<span class="st">&quot;location&quot;</span>))</span>
<span id="cb31-31"><a href="case-study-er-injuries.html#cb31-31" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb31-32"><a href="case-study-er-injuries.html#cb31-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fluidRow</span>(</span>
<span id="cb31-33"><a href="case-study-er-injuries.html#cb31-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column</span>(<span class="dv">12</span>, <span class="fu">plotOutput</span>(<span class="st">&quot;age_sex&quot;</span>))</span>
<span id="cb31-34"><a href="case-study-er-injuries.html#cb31-34" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb31-35"><a href="case-study-er-injuries.html#cb31-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fluidRow</span>(</span>
<span id="cb31-36"><a href="case-study-er-injuries.html#cb31-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column</span>(<span class="dv">2</span>, <span class="fu">actionButton</span>(<span class="st">&quot;prev_story&quot;</span>, <span class="st">&quot;Previous story&quot;</span>)),</span>
<span id="cb31-37"><a href="case-study-er-injuries.html#cb31-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column</span>(<span class="dv">2</span>, <span class="fu">actionButton</span>(<span class="st">&quot;next_story&quot;</span>, <span class="st">&quot;Next story&quot;</span>)),</span>
<span id="cb31-38"><a href="case-study-er-injuries.html#cb31-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">column</span>(<span class="dv">8</span>, <span class="fu">textOutput</span>(<span class="st">&quot;narrative&quot;</span>))</span>
<span id="cb31-39"><a href="case-study-er-injuries.html#cb31-39" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-40"><a href="case-study-er-injuries.html#cb31-40" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-41"><a href="case-study-er-injuries.html#cb31-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-42"><a href="case-study-er-injuries.html#cb31-42" aria-hidden="true" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output, session) {</span>
<span id="cb31-43"><a href="case-study-er-injuries.html#cb31-43" aria-hidden="true" tabindex="-1"></a>  selected <span class="ot">&lt;-</span> <span class="fu">reactive</span>(injuries <span class="sc">%&gt;%</span> <span class="fu">filter</span>(prod_code <span class="sc">==</span> input<span class="sc">$</span>code))</span>
<span id="cb31-44"><a href="case-study-er-injuries.html#cb31-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-45"><a href="case-study-er-injuries.html#cb31-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Find the maximum possible of rows.</span></span>
<span id="cb31-46"><a href="case-study-er-injuries.html#cb31-46" aria-hidden="true" tabindex="-1"></a>  max_no_rows <span class="ot">&lt;-</span> <span class="fu">reactive</span>(</span>
<span id="cb31-47"><a href="case-study-er-injuries.html#cb31-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">max</span>(<span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">selected</span>()<span class="sc">$</span>diag)),</span>
<span id="cb31-48"><a href="case-study-er-injuries.html#cb31-48" aria-hidden="true" tabindex="-1"></a>        <span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">selected</span>()<span class="sc">$</span>body_part)),</span>
<span id="cb31-49"><a href="case-study-er-injuries.html#cb31-49" aria-hidden="true" tabindex="-1"></a>        <span class="fu">length</span>(<span class="fu">unique</span>(<span class="fu">selected</span>()<span class="sc">$</span>location)))</span>
<span id="cb31-50"><a href="case-study-er-injuries.html#cb31-50" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-51"><a href="case-study-er-injuries.html#cb31-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-52"><a href="case-study-er-injuries.html#cb31-52" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Update the maximum value for the numericInput based on max_no_rows().</span></span>
<span id="cb31-53"><a href="case-study-er-injuries.html#cb31-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">observeEvent</span>(input<span class="sc">$</span>code, {</span>
<span id="cb31-54"><a href="case-study-er-injuries.html#cb31-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">updateNumericInput</span>(session, <span class="st">&quot;rows&quot;</span>, <span class="at">max =</span> <span class="fu">max_no_rows</span>())</span>
<span id="cb31-55"><a href="case-study-er-injuries.html#cb31-55" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb31-56"><a href="case-study-er-injuries.html#cb31-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-57"><a href="case-study-er-injuries.html#cb31-57" aria-hidden="true" tabindex="-1"></a>  table_rows <span class="ot">&lt;-</span> <span class="fu">reactive</span>(input<span class="sc">$</span>rows <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb31-58"><a href="case-study-er-injuries.html#cb31-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-59"><a href="case-study-er-injuries.html#cb31-59" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>diag <span class="ot">&lt;-</span> <span class="fu">renderTable</span>(</span>
<span id="cb31-60"><a href="case-study-er-injuries.html#cb31-60" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count_top</span>(<span class="fu">selected</span>(), diag, <span class="at">n =</span> <span class="fu">table_rows</span>()), <span class="at">width =</span> <span class="st">&quot;100%&quot;</span>)</span>
<span id="cb31-61"><a href="case-study-er-injuries.html#cb31-61" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-62"><a href="case-study-er-injuries.html#cb31-62" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>body_part <span class="ot">&lt;-</span> <span class="fu">renderTable</span>(</span>
<span id="cb31-63"><a href="case-study-er-injuries.html#cb31-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count_top</span>(<span class="fu">selected</span>(), body_part, <span class="at">n =</span> <span class="fu">table_rows</span>()), <span class="at">width =</span> <span class="st">&quot;100%&quot;</span>)</span>
<span id="cb31-64"><a href="case-study-er-injuries.html#cb31-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-65"><a href="case-study-er-injuries.html#cb31-65" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>location <span class="ot">&lt;-</span> <span class="fu">renderTable</span>(</span>
<span id="cb31-66"><a href="case-study-er-injuries.html#cb31-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count_top</span>(<span class="fu">selected</span>(), location, <span class="at">n =</span> <span class="fu">table_rows</span>()), <span class="at">width =</span> <span class="st">&quot;100%&quot;</span>)</span>
<span id="cb31-67"><a href="case-study-er-injuries.html#cb31-67" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-68"><a href="case-study-er-injuries.html#cb31-68" aria-hidden="true" tabindex="-1"></a>  summary <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb31-69"><a href="case-study-er-injuries.html#cb31-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">selected</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-70"><a href="case-study-er-injuries.html#cb31-70" aria-hidden="true" tabindex="-1"></a>      <span class="fu">count</span>(age, sex, <span class="at">wt =</span> weight) <span class="sc">%&gt;%</span></span>
<span id="cb31-71"><a href="case-study-er-injuries.html#cb31-71" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(population, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;sex&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb31-72"><a href="case-study-er-injuries.html#cb31-72" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">rate =</span> n <span class="sc">/</span> population <span class="sc">*</span> <span class="fl">1e4</span>)</span>
<span id="cb31-73"><a href="case-study-er-injuries.html#cb31-73" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb31-74"><a href="case-study-er-injuries.html#cb31-74" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-75"><a href="case-study-er-injuries.html#cb31-75" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>age_sex <span class="ot">&lt;-</span> <span class="fu">renderPlot</span>({</span>
<span id="cb31-76"><a href="case-study-er-injuries.html#cb31-76" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="sc">$</span>y <span class="sc">==</span> <span class="st">&quot;count&quot;</span>) {</span>
<span id="cb31-77"><a href="case-study-er-injuries.html#cb31-77" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summary</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-78"><a href="case-study-er-injuries.html#cb31-78" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ggplot</span>(<span class="fu">aes</span>(age, n, <span class="at">colour =</span> sex)) <span class="sc">+</span></span>
<span id="cb31-79"><a href="case-study-er-injuries.html#cb31-79" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb31-80"><a href="case-study-er-injuries.html#cb31-80" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Estimated number of injuries&quot;</span>) <span class="sc">+</span></span>
<span id="cb31-81"><a href="case-study-er-injuries.html#cb31-81" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme_grey</span>(<span class="dv">15</span>)</span>
<span id="cb31-82"><a href="case-study-er-injuries.html#cb31-82" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb31-83"><a href="case-study-er-injuries.html#cb31-83" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summary</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-84"><a href="case-study-er-injuries.html#cb31-84" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ggplot</span>(<span class="fu">aes</span>(age, rate, <span class="at">colour =</span> sex)) <span class="sc">+</span></span>
<span id="cb31-85"><a href="case-study-er-injuries.html#cb31-85" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_line</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb31-86"><a href="case-study-er-injuries.html#cb31-86" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Injuries per 10,000 people&quot;</span>) <span class="sc">+</span></span>
<span id="cb31-87"><a href="case-study-er-injuries.html#cb31-87" aria-hidden="true" tabindex="-1"></a>        <span class="fu">theme_grey</span>(<span class="dv">15</span>)</span>
<span id="cb31-88"><a href="case-study-er-injuries.html#cb31-88" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb31-89"><a href="case-study-er-injuries.html#cb31-89" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb31-90"><a href="case-study-er-injuries.html#cb31-90" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-91"><a href="case-study-er-injuries.html#cb31-91" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Store the maximum posible number of stories.</span></span>
<span id="cb31-92"><a href="case-study-er-injuries.html#cb31-92" aria-hidden="true" tabindex="-1"></a>  max_no_stories <span class="ot">&lt;-</span> <span class="fu">reactive</span>(<span class="fu">length</span>(<span class="fu">selected</span>()<span class="sc">$</span>narrative))</span>
<span id="cb31-93"><a href="case-study-er-injuries.html#cb31-93" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-94"><a href="case-study-er-injuries.html#cb31-94" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reactive used to save the current position in the narrative list.</span></span>
<span id="cb31-95"><a href="case-study-er-injuries.html#cb31-95" aria-hidden="true" tabindex="-1"></a>  story <span class="ot">&lt;-</span> <span class="fu">reactiveVal</span>(<span class="dv">1</span>)</span>
<span id="cb31-96"><a href="case-study-er-injuries.html#cb31-96" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-97"><a href="case-study-er-injuries.html#cb31-97" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reset the story counter if the user changes the product code. </span></span>
<span id="cb31-98"><a href="case-study-er-injuries.html#cb31-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">observeEvent</span>(input<span class="sc">$</span>code, {</span>
<span id="cb31-99"><a href="case-study-er-injuries.html#cb31-99" aria-hidden="true" tabindex="-1"></a>    <span class="fu">story</span>(<span class="dv">1</span>)</span>
<span id="cb31-100"><a href="case-study-er-injuries.html#cb31-100" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb31-101"><a href="case-study-er-injuries.html#cb31-101" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-102"><a href="case-study-er-injuries.html#cb31-102" aria-hidden="true" tabindex="-1"></a>  <span class="co"># When the user clicks &quot;Next story&quot;, increase the current position in the</span></span>
<span id="cb31-103"><a href="case-study-er-injuries.html#cb31-103" aria-hidden="true" tabindex="-1"></a>  <span class="co"># narrative but never go beyond the interval [1, length of the narrative].</span></span>
<span id="cb31-104"><a href="case-study-er-injuries.html#cb31-104" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Note that the mod function (%%) is keeping `current`` within this interval.</span></span>
<span id="cb31-105"><a href="case-study-er-injuries.html#cb31-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">observeEvent</span>(input<span class="sc">$</span>next_story, {</span>
<span id="cb31-106"><a href="case-study-er-injuries.html#cb31-106" aria-hidden="true" tabindex="-1"></a>    <span class="fu">story</span>((<span class="fu">story</span>() <span class="sc">%%</span> <span class="fu">max_no_stories</span>()) <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb31-107"><a href="case-study-er-injuries.html#cb31-107" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb31-108"><a href="case-study-er-injuries.html#cb31-108" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-109"><a href="case-study-er-injuries.html#cb31-109" aria-hidden="true" tabindex="-1"></a>  <span class="co"># When the user clicks &quot;Previous story&quot; decrease the current position in the</span></span>
<span id="cb31-110"><a href="case-study-er-injuries.html#cb31-110" aria-hidden="true" tabindex="-1"></a>  <span class="co"># narrative. Note that we also take advantage of the mod function.</span></span>
<span id="cb31-111"><a href="case-study-er-injuries.html#cb31-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">observeEvent</span>(input<span class="sc">$</span>prev_story, {</span>
<span id="cb31-112"><a href="case-study-er-injuries.html#cb31-112" aria-hidden="true" tabindex="-1"></a>    <span class="fu">story</span>(((<span class="fu">story</span>() <span class="sc">-</span> <span class="dv">2</span>) <span class="sc">%%</span> <span class="fu">max_no_stories</span>()) <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb31-113"><a href="case-study-er-injuries.html#cb31-113" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb31-114"><a href="case-study-er-injuries.html#cb31-114" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-115"><a href="case-study-er-injuries.html#cb31-115" aria-hidden="true" tabindex="-1"></a>  output<span class="sc">$</span>narrative <span class="ot">&lt;-</span> <span class="fu">renderText</span>({</span>
<span id="cb31-116"><a href="case-study-er-injuries.html#cb31-116" aria-hidden="true" tabindex="-1"></a>    <span class="fu">selected</span>()<span class="sc">$</span>narrative[<span class="fu">story</span>()]</span>
<span id="cb31-117"><a href="case-study-er-injuries.html#cb31-117" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb31-118"><a href="case-study-er-injuries.html#cb31-118" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-119"><a href="case-study-er-injuries.html#cb31-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-120"><a href="case-study-er-injuries.html#cb31-120" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(ui, server)</span></code></pre></div>
</div>
</div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="basic-reactivity.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="workflow.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": {}
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/r4ds/mastering_shiny_book_solutions/edit/master/basic-case-study.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": {},
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
